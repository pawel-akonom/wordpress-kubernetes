1. Creating two debian virtual machines with vagrant

2. Install all needed packages - docker-engine, kubeadm, kubelet and kubectl on both debian virtual machines

https://kubernetes.io/docs/setup/independent/install-kubeadm/

3. Create a craster on debian1

 sudo kubeadm init --node-name debian-1 --apiserver-advertise-address 192.168.100.1 --pod-network-cidr=10.1.0.0/16

4. Create kubernetes networking with kube-routet

  KUBECONFIG=/etc/kubernetes/admin.conf kubectl apply -f https://raw.githubusercontent.com/cloudnativelabs/kube-router/master/daemonset/kubeadm-kuberouter.yaml

  scp .kube/config 192.168.100.2:/home/vagrant/.kube/config

  iptables -A INPUT -p tcp -s 192.168.100.2 -j ACCEPT
  iptables -A OUTPUT -p tcp -d 192.168.100.2 -j ACCEP

5. Join the cluster on debian2

 sudo kubeadm join 192.168.100.1:6443 --token sv5ws1.ipf5n48cq504fddq --discovery-token-ca-cert-hash sha256:4b04ffe9c2fc3c07eff94e4b7bcc4739b9bcd0d1944f51723c8cbf6e99e02096

6. check all cluster nodes on master node - debian1

vagrant@debian-1:~$ kubectl get nodes
NAME       STATUS    AGE       VERSION
debian-1   Ready     17m       v1.11.2
debian-2   Ready     24s       v1.11.2

6. test kubernetes cluster

vagrant@debian-1:~$ kubectl run nginx-kube-test --image nginx --port=80
deployment "nginx-kube-test" created

vagrant@debian-1:~$ kubectl expose deployment nginx-kube-test --type=NodePort
service "nginx-kube-test" expose

vagrant@debian-1:~$ kubectl get deployment
NAME              DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
nginx-kube-test   1         1         1            0           19s

# find exposed port
vagrant@debian-1:~$ kubectl get services
NAME              CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
nginx-kube-test   10.96.36.63   <nodes>       80:31070/TCP   17s
kubernetes        10.96.0.1     <none>        443/TCP        19

# find node where nginx is running
vagrant@debian-1:~$ kubectl describe pod nginx-kube-test | grep Node:
Node:		debian-2/10.0.2.15

# on mother OS connect to debian2 on port 31070

mint@Akus:~$ curl http://192.168.100.2:31070/

<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>







